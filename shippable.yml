# language setting
language: node_js

# version numbers, testing against two versions of node
node_js:
  - 0.12.6

# Only build master
branches:
  only:
    - master

# The path for Xunit to output test reports
env:
  global:
    - AWSAccessKeyId=AKIAJSKBGDMZ2Y2UEYSA
    - secure: ULk6E5hebb1E/FEMt5pcAx+at1AmCP/yNPhQc4cSHzUOcoe1Eh9lwVo4iLz2TFAt/+gjf+2YTm+KtlA+yI2GxCnxT6NbmfQ9MGxYfZPu+7StRqV3dxNOUp82NTl0q9ZxBMkQhfu/24B8fMUf/6Szxhwtilvn72bShCDRbcQvEhxVLPuQ3Qv/wgiCkXyVVr2GTlKGT9UTriOB7Hch2iDYrIlUDT08R0hkW5NBGQjtz15W2RwJQumNoNmgXoB21hk2zLiNkBsw+SGa+c01KWxY29kRnxMGpzoj1kuwosbng32JS1nmt31Pfyf3+n/zRNhG4EyA0YOmDKQg4t4UW7nWyQ==

# Notifications for minimal bombarding of builds via email
notifications:
     email:
         recipients:
             - fogle.george@gmail.com
         on_success: always
         on_failure: always

before_install:
  - pip install awsebcli

# Create directories
before_script:
  - mkdir -p ~/.aws
  - echo '[profile eb-cli]' > ~/.aws/config
  - echo "aws_access_key_id = $AWSAccessKeyId" >> ~/.aws/config
  - echo "aws_secret_access_key = $AWSSecretKey" >> ~/.aws/config

script:
  - mkdir -p public
  - mkdir -p .elasticbeanstalk
  - cp config.yml .elasticbeanstalk/
  - npm run build

# Deploy to Beanstalk
after_success:
  - if [ "$BRANCH" = "master" ]; then eb init && eb deploy; fi
