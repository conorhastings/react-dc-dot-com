# language setting
language: node_js

# version numbers, testing against two versions of node
node_js:
  - 0.12.6

# Only build master
branches:
  only:
    - master

# The path for Xunit to output test reports
env:
  global:
    - AWSAccessKeyId=AKIAI5GVT7VFUV42AO3Q
    - secure: N8pQyP9leJvoK2g80sMHX5tpeMhdXFpga8VWAUExhRe9lz0XClYV3gBYDRD+KxXR85csvf9JiLVpGAXAajz0SarHsKuSO463kBy9CTI54MONQ342gQ3DYZFj3gmbTxR8K4VP6VKpv9sdoJ548zAx3ddoYzdnvzwpGJ037hy4hUzNYnfMdt615S2GV5AOU4yt3Drm6psw+8ya/2RJlQZy52cJ2BnJaNAIBRoQpf9RMAtS6Rh4L0yzb+oN1xdO9A7rjSRS1V1xqeO23VYzXlMAYS5ARJUDh/G6YqYkv8WUdWNUNPx7809vcSq5h9U2cJTyRWkUSNzgZzpXpEfSdgcn0g==

# Notifications for minimal bombarding of builds via email
notifications:
     email:
         recipients:
             - fogle.george@gmail.com
         on_success: always
         on_failure: always

before_install:
  - pip install awsebcli

# Create directories
before_script:
  - mkdir -p ~/.aws
  - echo '[profile reactdc]' > ~/.aws/config
  - echo "aws_access_key_id = $AWSAccessKeyId" >> ~/.aws/config
  - echo "aws_secret_access_key = $AWSSecretKey" >> ~/.aws/config

script:
  - mkdir -p public
  - mkdir -p .elasticbeanstalk
  - cp config.yml .elasticbeanstalk/
  - npm run build

# Deploy to Beanstalk
after_success:
  - if [ "$BRANCH" = "master" ]; then eb init && eb deploy; fi
