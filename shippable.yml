# language setting
language: node_js

# version numbers, testing against two versions of node
node_js:
  - 0.12.6

# Only build master
branches:
  only:
    - master

# The path for Xunit to output test reports
env:
  global:
    - AWSAccessKeyId=AKIAI5GVT7VFUV42AO3Q
    - secure: dHhkaFTK+BCyrRnwPwpmxBBnAGl0eoxT2ld9ak7WLXWwDIaMUxDuQSuWttB2mJUqPvadmTGa6BZ4rUD1FY8SN7430AOt7qes5K/JQ9ex/aMIxsVVZQPzL25QY2VOW8xIKV+zXMbZgnoLiiUKC5rqF643CoM2raSQYFZXoQlS6xV7e88WF36Jbtvbn6ptnf2s3+/yycz5RLv1wOhBA6FsAqm/89uOUaFmq6wwhblg5arw7SyreSR/ezDRr9HgstLUId/KWBe23f9jUziBfMva40q3goD/EaXwGNbhw3u1Zs+Ds++UQu5hKB981bmu3uvIYBf2kztX6GnP7ZR5DBgfmg==
# Notifications for minimal bombarding of builds via email
notifications:
     email:
         recipients:
             - fogle.george@gmail.com
         on_success: always
         on_failure: always

before_install:
  - pip install awsebcli

# Create directories
before_script:
  - mkdir -p ~/.aws
  - echo '[profile reactdc]' > ~/.aws/config
  - echo "aws_access_key_id = $AWSAccessKeyId" >> ~/.aws/config
  - echo "aws_secret_access_key = $AWSSecretKey" >> ~/.aws/config

script:
  - mkdir -p public
  - mkdir -p .elasticbeanstalk
  - cp config.yml .elasticbeanstalk/
  - npm run build

# Deploy to Beanstalk
after_success:
  - if [ "$BRANCH" = "master" ]; then eb init && eb deploy; fi
